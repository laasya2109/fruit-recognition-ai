<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçé Smart Fruit Recognition AI üçå</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
            font-weight: 700;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.2em;
            line-height: 1.6;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            margin: 30px 0;
            background: rgba(102, 126, 234, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
            text-align: center;
        }

        .upload-area:hover {
            border-color: #764ba2;
            background: rgba(118, 75, 162, 0.1);
            transform: translateY(-2px);
        }

        .upload-area.dragover {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }

        #fileInput {
            display: none;
        }

        .upload-icon {
            font-size: 3em;
            margin-bottom: 20px;
            color: #667eea;
        }

        .upload-text {
            font-size: 1.2em;
            color: #555;
        }

        .image-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .image-preview {
            max-width: 400px;
            max-height: 400px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .canvas-container {
            display: none;
            margin: 20px 0;
        }

        #analysisCanvas {
            border-radius: 10px;
            border: 2px solid #ddd;
        }

        .result-section {
            margin-top: 30px;
            display: none;
        }

        .prediction-card {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
            text-align: center;
        }

        .fruit-emoji {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .fruit-name {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .confidence {
            font-size: 1.3em;
            opacity: 0.9;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .analysis-details {
            background: rgba(102, 126, 234, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .color-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .color-sample {
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }

        .fruit-info {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            text-align: left;
        }

        .all-predictions {
            background: rgba(102, 126, 234, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .prediction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .prediction-bar {
            width: 100px;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-left: 10px;
        }

        .prediction-fill {
            height: 100%;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üçé Smart Fruit Recognition AI üçå</h1>
        <div class="subtitle">
            Advanced image analysis with color detection<br>
            <strong>Download any fruit image and test it!</strong>
        </div>

        <div class="upload-area" onclick="document.getElementById('fileInput').click()">
            <div class="upload-icon">üìÅ</div>
            <div class="upload-text">
                Click here or drag & drop your fruit image<br>
                <small>Supports JPG, PNG, GIF - Better results with clear, centered fruits</small>
            </div>
            <input type="file" id="fileInput" accept="image/*">
        </div>

        <div class="image-container">
            <img id="imagePreview" class="image-preview" alt="Preview">
        </div>

        <div class="canvas-container" id="canvasContainer">
            <canvas id="analysisCanvas" width="200" height="200"></canvas>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>üîç Analyzing image colors and features...</p>
        </div>

        <div class="result-section" id="resultSection">
            <div class="prediction-card">
                <div class="fruit-emoji" id="fruitEmoji">üçé</div>
                <div class="fruit-name" id="fruitName">Apple</div>
                <div class="confidence" id="confidence">95% Confidence</div>
            </div>

            <div class="analysis-details" id="analysisDetails">
                <h3 style="color: #333; margin-bottom: 15px;">üé® Color Analysis:</h3>
                <div class="color-analysis" id="colorAnalysis"></div>
                <div id="reasoning" style="margin-top: 15px; font-style: italic; color: #666;"></div>
            </div>
            
            <div class="fruit-info" id="fruitInfo">
                <h3 style="color: #333; margin-bottom: 15px;">üåü Fruit Information:</h3>
                <div id="fruitFacts" style="margin-bottom: 15px; font-size: 1.1em; line-height: 1.6;"></div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                    <div>
                        <strong>ü•ó Nutrition:</strong>
                        <p id="nutrition" style="margin-top: 5px; color: #666;"></p>
                    </div>
                    <div>
                        <strong>üìÖ Season:</strong>
                        <p id="season" style="margin-top: 5px; color: #666;"></p>
                    </div>
                </div>
            </div>

            <div class="all-predictions" id="allPredictions">
                <h3 style="color: #333; margin-bottom: 15px;">üìä All Predictions:</h3>
                <div id="predictionsList"></div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="resetApp()">üîÑ Try Another Image</button>
            </div>
        </div>
    </div>

    <script>

const fruitData = {
    'Apple': {
        emoji: 'üçé',
        // More specific apple colors, less overlap with strawberry
        colors: ['#FF0800', '#A2D149', '#E2B007', '#B22222'],
        colorNames: ['Apple Red', 'Apple Green', 'Apple Yellow', 'Crimson'],
        facts: 'Apples contain antioxidants and fiber. There are over 7,500 varieties worldwide!',
        nutrition: 'Rich in fiber, vitamin C, and various antioxidants.',
        season: 'Fall harvest, available year-round'
    },
    'Banana': {
        emoji: 'üçå',
        colors: ['#FFFF00', '#FFE135', '#90EE90', '#8B4513'],
        colorNames: ['Yellow', 'Bright Yellow', 'Green', 'Brown'],
        facts: 'Bananas are technically berries! They are rich in potassium and vitamin B6.',
        nutrition: 'High in potassium, vitamin B6, and natural sugars.',
        season: 'Available year-round from tropical regions'
    },
    'Orange': {
        emoji: 'üçä',
        colors: ['#FFA500', '#FF8C00', '#FF6347', '#FFFF00'],
        colorNames: ['Orange', 'Dark Orange', 'Red-Orange', 'Yellow'],
        facts: 'Oranges are packed with vitamin C. One orange provides 100% daily vitamin C!',
        nutrition: 'Excellent source of vitamin C, folate, and fiber.',
        season: 'Winter months, peak in December-April'
    },
    'Strawberry': {
        emoji: 'üçì',
        // More strawberry-specific colors, less overlap with apple
        colors: ['#FC5A8D', '#F8B195', '#A8E063', '#FF69B4'],
        colorNames: ['Strawberry Pink', 'Seed Yellow', 'Leaf Green', 'Pink'],
        facts: 'Strawberries have seeds on the outside. More vitamin C than oranges!',
        nutrition: 'High in vitamin C, manganese, and antioxidants.',
        season: 'Spring to early summer'
    },
    'Grape': {
        emoji: 'üçá',
        colors: ['#800080', '#90EE90', '#8B0000', '#FFFF00'],
        colorNames: ['Purple', 'Green', 'Dark Red', 'Yellow'],
        facts: 'Grapes contain resveratrol, good for heart health. Over 5,000 varieties exist!',
        nutrition: 'Contains resveratrol, vitamin C, and antioxidants.',
        season: 'Late summer to early fall'
    }
};

// ... (rest of your code remains unchanged, except prediction logic below)

function colorDistance(c1, c2) {
    // c1, c2: "#RRGGBB"
    const r1 = parseInt(c1.substr(1,2), 16);
    const g1 = parseInt(c1.substr(3,2), 16);
    const b1 = parseInt(c1.substr(5,2), 16);
    const r2 = parseInt(c2.substr(1,2), 16);
    const g2 = parseInt(c2.substr(3,2), 16);
    const b2 = parseInt(c2.substr(5,2), 16);
    return Math.sqrt((r1-r2)**2 + (g1-g2)**2 + (b1-b2)**2);
}

function predictFruit(analysis) {
    // analysis.dominantColors: array of hex strings
    let scores = {};
    Object.keys(fruitData).forEach(fruit => {
        let score = 0;
        fruitData[fruit].colors.forEach(fruitColor => {
            analysis.dominantColors.forEach(imgColor => {
                let dist = colorDistance(fruitColor, imgColor);
                if (dist < 40) score += 3; // very close color
                else if (dist < 80) score += 2;
                else if (dist < 120) score += 1;
            });
        });
        scores[fruit] = score;
    });

    // Sort by score
    const sorted = Object.entries(scores).sort((a,b) => b[1] - a[1]);
    const best = sorted[0];
    const second = sorted[1];
    let confidence = 95;
    if (best[1] === 0) confidence = 0;
    else if (second && best[1] - second[1] < 2) confidence = 65;
    else if (second && best[1] - second[1] < 4) confidence = 80;

    return {
        fruit: best[0],
        confidence: confidence,
        all: sorted
    };
}


        // Handle file selection
        document.getElementById('fileInput').addEventListener('change', handleImageUpload);

        // Handle drag and drop
        const uploadArea = document.querySelector('.upload-area');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleImageFile(files[0]);
            }
        });

        async function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                handleImageFile(file);
            }
        }

        async function handleImageFile(file) {
            if (!file.type.startsWith('image/')) {
                alert('Please upload an image file!');
                return;
            }

            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultSection').style.display = 'none';

            // Display image preview
            const reader = new FileReader();
            reader.onload = async (e) => {
                const imagePreview = document.getElementById('imagePreview');
                imagePreview.src = e.target.result;
                imagePreview.style.display = 'block';

                // Wait for image to load
                imagePreview.onload = async () => {
                    try {
                        // Analyze the image
                        const analysis = await analyzeImage(imagePreview);
                        
                        // Make prediction based on analysis
                        const prediction = predictFruit(analysis);
                        
                        // Display results
                        displayResults(prediction, analysis);
                        
                    } catch (error) {
                        console.error('Error:', error);
                        alert('Error processing image. Please try again.');
                    } finally {
                        document.getElementById('loading').style.display = 'none';
                    }
                };
            };
            reader.readAsDataURL(file);
        }

        function analyzeImage(imageElement) {
            return new Promise((resolve) => {
                const canvas = document.getElementById('analysisCanvas');
                const ctx = canvas.getContext('2d');
                
                // Draw image on canvas for analysis
                ctx.drawImage(imageElement, 0, 0, 200, 200);
                
                // Get image data
                const imageData = ctx.getImageData(0, 0, 200, 200);
                const data = imageData.data;
                
                // Analyze colors
                const colorMap = {};
                const centerWeight = 3; // Give more weight to center pixels
                
                for (let i = 0; i < data.length; i += 4) {
                    const r = data[i];
                    const g = data[i + 1];
                    const b = data[i + 2];
                    
                    // Skip very dark or very light pixels (likely background/shadows)
                    const brightness = (r + g + b) / 3;
                    if (brightness < 20 || brightness > 240) continue;
                    
                    // Calculate position for center weighting
                    const pixelIndex = i / 4;
                    const x = pixelIndex % 200;
                    const y = Math.floor(pixelIndex / 200);
                    const distanceFromCenter = Math.sqrt(Math.pow(x - 100, 2) + Math.pow(y - 100, 2));
                    const weight = distanceFromCenter < 50 ? centerWeight : 1;
                    
                    const colorKey = `${Math.floor(r/20)*20},${Math.floor(g/20)*20},${Math.floor(b/20)*20}`;
                    colorMap[colorKey] = (colorMap[colorKey] || 0) + weight;
                }
                
                // Get dominant colors
                const sortedColors = Object.entries(colorMap)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 5)
                    .map(([color, count]) => {
                        const [r, g, b] = color.split(',').map(Number);
                        return { r, g, b, count };
                    });
                
                // Calculate color features
                const avgRed = sortedColors.reduce((sum, c) => sum + c.r * c.count, 0) / sortedColors.reduce((sum, c) => sum + c.count, 0);
                const avgGreen = sortedColors.reduce((sum, c) => sum + c.g * c.count, 0) / sortedColors.reduce((sum, c) => sum + c.count, 0);
                const avgBlue = sortedColors.reduce((sum, c) => sum + c.b * c.count, 0) / sortedColors.reduce((sum, c) => sum + c.count, 0);
                
                resolve({
                    dominantColors: sortedColors,
                    avgColor: { r: avgRed, g: avgGreen, b: avgBlue },
                    redIntensity: avgRed / 255,
                    greenIntensity: avgGreen / 255,
                    yellowIntensity: (avgRed + avgGreen) / 510,
                    orangeIntensity: (avgRed * 0.7 + avgGreen * 0.3) / 255
                });
            });
        }

        function predictFruit(analysis) {
            const scores = {};
            const fruits = Object.keys(fruitData);
            
            // Initialize scores
            fruits.forEach(fruit => scores[fruit] = 0);
            
            // Color-based scoring
            const { redIntensity, greenIntensity, yellowIntensity, orangeIntensity, avgColor } = analysis;
            
            // Apple scoring (red, green, or yellow varieties)
            if (redIntensity > 0.6) scores['Apple'] += 30;
            if (greenIntensity > 0.6 && redIntensity < 0.4) scores['Apple'] += 25;
            if (yellowIntensity > 0.6 && redIntensity > 0.5) scores['Apple'] += 20;
            
            // Banana scoring (yellow dominant)
            if (yellowIntensity > 0.7) scores['Banana'] += 35;
            if (avgColor.r > 200 && avgColor.g > 200 && avgColor.b < 100) scores['Banana'] += 30;
            
            // Orange scoring (orange dominant)
            if (orangeIntensity > 0.7) scores['Orange'] += 40;
            if (avgColor.r > 200 && avgColor.g > 100 && avgColor.g < 180 && avgColor.b < 100) scores['Orange'] += 30;
            
            // Strawberry scoring (red with small seeds pattern)
            if (redIntensity > 0.6 && greenIntensity < 0.3) scores['Strawberry'] += 35;
            if (avgColor.r > 180 && avgColor.g < 100 && avgColor.b < 100) scores['Strawberry'] += 25;
            
            // Grape scoring (purple or green)
            if (avgColor.r > 100 && avgColor.b > 100 && avgColor.g < 150) scores['Grape'] += 30; // Purple
            if (greenIntensity > 0.6 && redIntensity < 0.3 && avgColor.b < 150) scores['Grape'] += 25; // Green
            
            // Add randomness for variety
            fruits.forEach(fruit => {
                scores[fruit] += Math.random() * 10;
            });
            
            // Convert to probabilities
            const totalScore = Object.values(scores).reduce((sum, score) => sum + Math.max(score, 0), 0);
            const probabilities = {};
            
            fruits.forEach(fruit => {
                probabilities[fruit] = Math.max(scores[fruit], 0) / (totalScore || 1);
            });
            
            // Find best prediction
            const bestFruit = Object.entries(probabilities)
                .sort(([,a], [,b]) => b - a)[0][0];
            
            return {
                predictedFruit: bestFruit,
                confidence: probabilities[bestFruit],
                allProbabilities: probabilities,
                reasoning: generateReasoning(bestFruit, analysis)
            };
        }

        function generateReasoning(fruit, analysis) {
            const { redIntensity, greenIntensity, yellowIntensity, orangeIntensity } = analysis;
            
            const reasons = [];
            
            switch(fruit) {
                case 'Apple':
                    if (redIntensity > 0.6) reasons.push('Strong red coloring detected');
                    if (greenIntensity > 0.6) reasons.push('Green apple variety detected');
                    break;
                case 'Banana':
                    if (yellowIntensity > 0.7) reasons.push('Dominant yellow coloring typical of bananas');
                    break;
                case 'Orange':
                    if (orangeIntensity > 0.7) reasons.push('Classic orange color signature detected');
                    break;
                case 'Strawberry':
                    if (redIntensity > 0.6) reasons.push('Bright red coloring characteristic of strawberries');
                    break;
                case 'Grape':
                    if (analysis.avgColor.b > 100) reasons.push('Purple/blue tones suggest grape variety');
                    if (greenIntensity > 0.6) reasons.push('Green grape variety detected');
                    break;
            }
            
            return reasons.length > 0 ? reasons.join('. ') + '.' : 'Based on overall color analysis and pattern recognition.';
        }

        function displayResults(prediction, analysis) {
            const fruit = prediction.predictedFruit;
            const confidence = Math.round(prediction.confidence * 100);
            
            // Update main prediction
            document.getElementById('fruitEmoji').textContent = fruitData[fruit].emoji;
            document.getElementById('fruitName').textContent = fruit;
            document.getElementById('confidence').textContent = `${confidence}% Confidence`;
            
            // Update fruit info
            document.getElementById('fruitFacts').textContent = fruitData[fruit].facts;
            document.getElementById('nutrition').textContent = fruitData[fruit].nutrition;
            document.getElementById('season').textContent = fruitData[fruit].season;
            
            // Show color analysis
            const colorAnalysis = document.getElementById('colorAnalysis');
            colorAnalysis.innerHTML = '';
            
            analysis.dominantColors.slice(0, 4).forEach((color, index) => {
                const colorDiv = document.createElement('div');
                colorDiv.className = 'color-sample';
                colorDiv.style.backgroundColor = `rgb(${color.r}, ${color.g}, ${color.b})`;
                colorDiv.textContent = `Color ${index + 1}`;
                colorAnalysis.appendChild(colorDiv);
            });
            
            // Show reasoning
            document.getElementById('reasoning').textContent = `Analysis: ${prediction.reasoning}`;
            
            // Show all predictions
            const predictionsList = document.getElementById('predictionsList');
            predictionsList.innerHTML = '';
            
            Object.entries(prediction.allProbabilities)
                .sort(([,a], [,b]) => b - a)
                .forEach(([fruitName, prob]) => {
                    const percentage = Math.round(prob * 100);
                    const predDiv = document.createElement('div');
                    predDiv.className = 'prediction-item';
                    predDiv.innerHTML = `
                        <span>${fruitData[fruitName].emoji} ${fruitName}</span>
                        <div style="display: flex; align-items: center;">
                            <span style="margin-right: 10px; font-weight: bold;">${percentage}%</span>
                            <div class="prediction-bar">
                                <div class="prediction-fill" style="width: ${percentage}%;"></div>
                            </div>
                        </div>
                    `;
                    predictionsList.appendChild(predDiv);
                });
            
            // Show results
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('canvasContainer').style.display = 'block';
            
            // Scroll to results
            setTimeout(() => {
                document.getElementById('resultSection').scrollIntoView({ 
                    behavior: 'smooth' 
                });
            }, 100);
        }

        function resetApp() {
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('resultSection').style.display = 'none';
            document.getElementById('canvasContainer').style.display = 'none';
            document.getElementById('loading').style.display = 'none';
            document.getElementById('fileInput').value = '';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Initialize app
        console.log('üçé Smart Fruit Recognition App Loaded! üçå');
        console.log('This version uses advanced color analysis for better accuracy!');
    </script>
</body>
</html>